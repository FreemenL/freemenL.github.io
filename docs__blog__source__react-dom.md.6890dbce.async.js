(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[47],{sub8:function(e,n,t){"use strict";t.r(n);var l=t("q1tI"),d=t.n(l),o=t("dEAq"),a=t("H1Ra"),r=d.a.memo((e=>{e.demos;return d.a.createElement(d.a.Fragment,null,d.a.createElement("div",{className:"markdown"},d.a.createElement("h3",{id:"react-\u865a\u62dfdom-\u6d45\u6790"},d.a.createElement(o["AnchorLink"],{to:"#react-\u865a\u62dfdom-\u6d45\u6790","aria-hidden":"true",tabIndex:-1},d.a.createElement("span",{className:"icon icon-link"})),"react \u865a\u62dfdom \u6d45\u6790"),d.a.createElement("p",null,"\u865a\u62dfdom \u7684\u6982\u5ff5 \u968f\u7740 react vue \u7b49\u6846\u67b6\u7684\u666e\u53ca \u5728\u524d\u7aef\u5708\u4e00\u5ea6\u6210\u4e3a\u4e00\u4e2a\u70ed\u8bae\u7684\u8bdd\u9898"),d.a.createElement("p",null,"\u4e89\u8bba\u70b9\u5728\u4e8e:"),d.a.createElement("ol",null,d.a.createElement("li",null,"\u865a\u62dfdom \u771f\u7684\u53ef\u4ee5\u63d0\u9ad8 \u64cd\u4f5cdom\u7684\u6027\u80fd\u4e48 ?"),d.a.createElement("li",null,"\u4e0e\u4f20\u7edf\u7684jq  \u76f8\u6bd4 \u6027\u80fd\u5230\u5e95\u6709\u591a\u5927\u63d0\u5347 ?")),d.a.createElement("p",null,"\u4e8e\u662f\u5e26\u7740\u8fd9\u4e24\u4e2a\u95ee\u9898 \u6211\u7814\u7a76\u4e86\u4e0b \u8fd9\u5757\u7684\u77e5\u8bc6"),d.a.createElement("p",null,"\u9996\u5148\u6211\u4eec\u6765\u770b\u4e0b\u865a\u62dfdom\u7684 \u6784\u5efa\u8fc7\u7a0b"),d.a.createElement("p",null,"jsx\u8bed\u6cd5\u7684\u8f6c\u6362 \u6211\u4eec\u4ee3\u7801\u4e2d\u7684jsx \u4e3b\u8981\u6709babel \u8d1f\u8d23\u8bed\u6cd5\u89e3\u6790\u8f6c\u6362 \u8fd9\u5757\u4e3b\u8981\u662f\u7528\u5230\u4e86babel-preset-react \u8fd9\u4e2a\u9884\u8bbe babel\u7684\u9884\u8bbe\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u662f\u4e00\u4e9bbabel \u63d2\u4ef6\u7684\u96c6\u5408 pabael-preset-react \u6240\u542b\u76d6\u7684\u63d2\u4ef6\u5305\u62ec\uff08preset-flow\uff0csyntax-jsx\uff0ctransform-react-jsx\uff0ctransform-react-display-name\uff09 \u4ed6\u8d1f\u8d23\u5c06\u6211\u4eec\u7684jsx\u8bed\u6cd5\u8f6c \u6362\u6210js\u53ef\u8bc6\u522b dom\u63cf\u8ff0\u5bf9\u8c61 \u539f\u7406\u662f\u751f\u6210\u4e00\u68f5\u62bd\u8c61\u8bed\u6cd5\u6811 \u7136\u540e\u8fdb\u884c\u76f8\u5e94\u7684\u8bed\u6cd5\u8f6c\u6362 - React.createElement \u65b9\u6cd5\u63a5\u53d7\u8f6c\u8bd1\u540e\u7684dom \u63cf\u8ff0\u5bf9\u8c61 \u521b\u5efa\u865a\u62dfdom\u6811 \u5728didmount\u7684\u65f6\u5019\u5c06\u8fd9\u68f5\u865a\u62dfdom\u6811\u8f6c\u6362\u6210\u771f\u6b63\u7684dom \u6302\u8f7d\u5230\u9875\u9762\u4e0a"),d.a.createElement(a["a"],{code:'//\u6839\u636e\u4f20\u8fdb\u6765\u7684\u503c \u4ea7\u751f\u865a\u62dfdom \u5bf9\u8c61\nclass Element{\n\tconstructor(type,props,children){\n\t\tthis.type = type;\n\t\tthis.props = props;\n\t\tthis.children = children;\n\t}\n}\n//\u751f\u6210\u865a\u62dfdom\nfunction createElement(type,props,children){\n\treturn new Element(type,props,children)\n}\n\nlet vertualDom = createElement(\'ul\',{class:"list"},[\n\tcreateElement(\'li\',{class:"item"},[\'a\']),\n\tcreateElement(\'li\',{class:"item"},[\'a\']),\n\tcreateElement(\'li\',{class:"item"},[\'a\'])\n])\n\n//\u8d1f\u8d23\u5c06\u865a\u62dfdom\u5904\u7406\u6210\u771f\u5b9e\u7684dom\nfunction render(eleObj){\n\tlet el  = document.createElement(eleObj.type);\n\tfor(let key in eleObj.props){\n\t\t//\u8bbe\u7f6e\u5c5e\u6027\u7684\u65b9\u6cd5\n\t\tsetAttr(el,key,eleObj.props[key]);\n\t}\n\teleObj.children.forEach((child)=>{\n\t\tchild = (child instanceof Element)?render(child):document.createTextNode(child);\n\t\tel.appendChild(child)\n\t})\n\treturn el;\n}\n\n//\u8bbe\u7f6e\u5c5e\u6027\nfunction setAttr(node,key,value){\n\tswitch(key){\n\t\tcase"value":\n\t\t\tif(node.tagName.toUpperCase()==="INPUT"||\n\t\t\t\tnode.tagName.toUpperCase()==="TEXTAREA"){\n\t\t\t\tnode.value = value\n\t\t\t}else{\n\t\t\t\tnode.setAttribute(key,value);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase"style":\n\t\t\tnode.style.cssText = value;\n\t\t   break;\n\t\tdefault:\n\t\t\tnode.setAttribute(key,value);\n\t\t   break;\n\n\t}\n}\n//\u628adom\u6302\u5728\u5230\u9875\u9762\u4e2d\nfunction renderDOm(el,target){\n\ttarget.appendChild(el);\n}',lang:"js"}),d.a.createElement("p",null,"\u865a\u62dfdom \u521b\u5efa \u5230\u6b64\u7ed3\u675f \uff08\u7b80\u964b\u7248\u5b9e\u73b0\uff09"),d.a.createElement("h3",{id:"dom-diff"},d.a.createElement(o["AnchorLink"],{to:"#dom-diff","aria-hidden":"true",tabIndex:-1},d.a.createElement("span",{className:"icon icon-link"})),"dom diff"),d.a.createElement("p",null,"\u63a5\u4e0b\u6765\u5c31\u662f\u6211\u4eec\u7684dom diff"),d.a.createElement("p",null,"\u5728\u6bcf\u6b21\u8c03\u7528setState \u7684\u65f6\u5019 \u4f1a\u751f\u6210 \u4e00\u9897\u65b0\u7684\u865a\u62dfdom \u6811 \u4e0e\u539f\u5148\u8001\u7684\u6811\u8fdb\u884c\u5bf9\u6bd4 \u5f97\u5230\u4e00\u4e2a\u8865\u4e01\u5305 \u7136\u540e \u62ff\u7740\u8fd9\u4e2a\u8865\u4e01\u5305\u53bbdom \u4e2d\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c \uff0cdom diff\u7684\u7b97\u6cd5 \u4e5f\u662f\u6574\u4e2a\u865a\u62dfdom \u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206 \u4e2a\u4eba\u7684\u7406\u89e3\uff1a \u539f\u5148\u7684\u7684\u8001\u6811\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u8d44\u6e90\u6c60 \u6211\u4eec\u7684\u65b0\u6811\u662f\u6211\u4eec\u6700\u7ec8\u60f3\u8981\u6e32\u67d3\u7684\u7ed3\u679c \u901a\u8fc7\u4e24\u4e2a\u6811\u5bf9\u6bd4 \u6211\u4eec\u80fd\u4ee5\u6700\u5c0f\u7684\u4ee3\u4ef7 \u6765\u66f4\u65b0\u7684\u6211\u4eec\u7684\u89c6\u56fe"),d.a.createElement(a["a"],{code:'const ATTRS = "ATTRS";\nconst TEXT = "TEXT";\nconst REMOVE = "REMOVE";\nconst REPLACE = \'REPLACE\';\nlet Index = 0;\n\n// \u5bf9\u6bd4\u524d\u540e\u4e24\u68f5\u6811 \u4e4b\u524d\u7684\u5dee\u522b \u8fd4\u56de\u4e00\u4e2a\u8865\u4e01\u5bf9\u8c61 \nfunction diff(oldTree,newTree){\n\n   let patches = {};\n   let index = 0;\n   walk(oldTree,newTree,index,patches);\n   return patches;\n}\n// \u5177\u4f53\u7684\u5bf9\u6bd4\u65b9\u6cd5 \nfunction walk(oldNode,newNode,index,patches){\n   let currentPatches = []; \n\n   if(!newNode){ //\u6ca1\u6709\u65b0\u7684\u8282\u70b9\u3002\u5220\u9664\n   \tcurrentPatches.push({type:REMOVE,index});\n   }else if(isString(oldNode)&&isString(newNode)){ //\u5224\u65ad\u6587\u672c\u662f\u5426\u53d8\u6362 \n   \tif(oldNode!==newNode){\n   \t\tcurrentPatches.push({type:TEXT,text:newNode});\n   \t}\n   }else if(oldNode.type === newNode.type){ //type \u76f8\u540c \u5224\u65ad\u5c5e\u6027 \n   \tlet attrs = diffAttr(oldNode.props,newNode.props);\n   \tif(Object.keys(attrs).length>0){\n   \t\tcurrentPatches.push({type:ATTRS,attrs})\n   \t}\n   \tdiffChildren(oldNode.children,newNode.children,index,patches)\n   }else{\n   \t//\u8282\u70b9\u88ab\u66ff\u6362\u4e86 \n   \tcurrentPatches.push({type:REPLACE,newNode})\n   }\n   if(currentPatches.length>0){  //\u4ea7\u751f\u8865\u4e01\u5305 \n   \tpatches[index] = currentPatches;\n   }\n}\n//\u5bf9\u6bd4\u5c5e\u6027\u7684\u4e0d\u540c \nfunction diffAttr(oldAttrs,newAttrs){\n   let patch = {}\n   //\u66f4\u65b0 \n   for(let attr in oldAttrs){\n   \tif(oldAttrs[attr]!== newAttrs[attr]){\n   \t\tpatch[attr] = newAttrs[attr]\n   \t}\n   }\n   //\u65b0\u589e\n   for(let attr in newAttrs){\n   \tif(!oldAttrs.hasOwnProperty(attr)){\n   \t\tpatch[attr] = newAttrs[attr]\n   \t}\n   }\n   return patch;\n}\n\n//\u9012\u5f52\u904d\u5386\u5b50\u8282\u70b9\u7684\u4e0d\u540c \nfunction diffChildren(oldNode,newNode,index,patches){\n   oldNode.forEach((child,idx)=>{\n   \twalk(child ,newNode[idx],++Index,patches)\n   })\n}\n\nfunction isString(node){\n   return Object.prototype.toString.call(node)=="[object String]";\n}',lang:"js"}),d.a.createElement("p",null,"\u5176\u5b9ekey \u5728\u6574\u4e2adom diff \u4e2d\u626e\u6f14\u4e86\u91cd\u8981\u7684 \u89d2\u8272\u4e3b\u8981\u4f18\u5316\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u6027\u80fd key \u4e3b\u8981\u610f\u4e49\u662f\u4e3a\u4e86\u4ee5\u6700\u5c0f\u7684\u4ee3\u4ef7\u6765\u66f4\u65b0dom \u5c31\u662f\u6700\u5c0f\u5316\u6027\u80fd\u5bf9\u8d44\u6e90\u6c60\uff08\u8001\u6811\uff09\u7684\u64cd\u4f5c"),d.a.createElement(a["a"],{code:'/**\n * \u5728 dom diff \u4e2d\u5982\u4f55\u8bc6\u522b\u548c\u5904\u7406 key \n*/\nconst REMOVE = "REMOVE";\nconst INSERT = "INSERT";\n\n\nclass Element{\n    constructor(tagName,key,children){\n        this.tagName = tagName;\n        this.key = key;\n        this.children = children;\n    }\n    render(){\n        let element = document.createElement(this.tagName);\n        element.innerHTML = this.children;\n        element.setAttribute("key",this.key);\n        return element;\n    }\n}\n\nfunction el(tagName,key,children){\n    return new Element(tagName,key,children);\n}\n\nlet oldChildren = [\n    el("li","A","A"),\n    el("li","B","B"),\n    el("li","C","C"),\n    el("li","D","D")\n];\nlet ul = document.createElement("ul");\noldChildren.forEach(item=> ul.appendChild(item.render()));\ndocument.body.appendChild(ul);\n\nlet newChildren = [\n    el("li","A","A"),\n    el("li","C","C"),\n    el("li","B","B"),\n    el("li","D","D"),\n];\n\nlet patches = diff(oldChildren,newChildren);\nconsole.log(patches)//[{ type: REMOVE,index:0},{type:INSERT,index,node}]\npatch(ul,patches);\nfunction patch(root,patches){\n    let oldNode;\n    let oldNodeMap = {};\n    Array.from(root.childNodes).forEach(node=>{\n        oldNodeMap[node.getAttribute("key")] = node  \n    });\n    patches.forEach(patch=>{\n        switch(patch.type){\n            case INSERT:\n                let newNode;\n                if(oldNodeMap[patch.node.key]){\n                    newNode = oldNodeMap[patch.node.key];\n                    delete oldNodeMap[patch.node.key];\n                }else{\n                    newNode = patch.node.render();\n                }\n                oldNode = root.childNodes[patch.index];\n                if(oldNode){\n                    root.insertBefore(newNode,oldNode);\n                }else{\n                    root.appendChild(newNode);\n                }\n                break;\n            case REMOVE:\n                oldNode = root.childNodes[patch.index];\n                root.removeChild(oldNode);\n                break;\n            default:\n                throw new Error("\u6ca1\u6709\u8fd9\u79cd\u5e03\u4e01\u7c7b\u578b\uff01");\n        }\n    })\n}\nfunction diff(oldChildren,newChildren){\n    \n    let patches = [];\n    let newKeys = newChildren.map(item=>item.key);\n    // \u7b2c\u4e00\u6b65\uff0c\u628a\u8001\u6570\u7ec4\u4e2d\u5728\u65b0\u6570\u7ec4\u4e2d\u6ca1\u6709\u7684\u5143\u7d20\u79fb\u9664\u6389\n    let oldIndex = 0;\n    let newLength = newChildren.length;\n    while(oldIndex< oldChildren.length){\n        let oldKey = oldChildren[oldIndex].key;\n        if(!newKeys.includes(oldKey)){\n            remove(oldIndex);\n            oldChildren.splice(oldIndex,1);\n        }else{\n            oldIndex++; \n        }\n    }\n    \n    oldIndex = 0;\n    let newIndex = 0;\n    //\u5bf9\u6bd4 newKey \u548c oldKey \u7684\u4e0d\u540c , \u63d2\u5165\u65b0\u7684\u8282\u70b9 \n    \n    while(newIndex<newLength){\n        let newKey =( newChildren[newIndex]||{}).key;\n        let oldKey =( oldChildren[oldIndex]||{}).key;\n        if(!oldKey){ // oldChildren \u88ab\u904d\u5386\u5b8c\u7684\u60c5\u51b5\u4e0b  \u7684\u60c5\u51b5\u4e0b\u63d2\u5165\u65b0\u7684\u5143\u7d20 newIndex++ 4c\n            insert(newIndex,newKey);\n            newIndex++;\n        }else if(oldKey!=newKey){  // oldKey!=newKey \u7684\u60c5\u51b5\u4e0b\u63d2\u5165\u65b0\u7684\u5143\u7d20 newIndex++ \n            let nextOldKey = (oldChildren[oldIndex+1]||{}).key;\n            if(nextOldKey==newKey){\n                remove(newIndex);\n                oldChildren.splice(oldIndex,1);\n            }else{\n                insert(newIndex,newKey);\n                newIndex++;\n            }\n        }else{\n            oldIndex++;\n            newIndex++\n        }\n    }\n\n    function insert(index,key){\n        patches.push({type:INSERT,index,node:el("li",key,key)});\n    }\n\n    function remove(index){\n        patches.push({type:REMOVE,index})\n    }\n\n    return patches;\n}',lang:"js"}),d.a.createElement("p",null,"\u6709\u51e0\u4e2a\u503c\u5f97\u6ce8\u610f\u7684 \u5730\u65b9"),d.a.createElement("ol",null,d.a.createElement("li",null,"\u865a\u62dfdom\u7684\u521b\u5efa\u8fc7\u7a0b \u5148\u5e8f\u6df1\u5ea6\u4f18\u5148"),d.a.createElement("li",null,"diff \u5bf9\u6bd4\u7684\u8fc7\u7a0b\u53ea\u4f1a\u5bf9\u540c\u7ea7\u8fdb\u884c\u76f8\u5e94\u7684\u6bd4\u8f83"),d.a.createElement("li",null,"\u6253\u8865\u4e01\u7684\u8fc7\u7a0b\u662f \u4ece\u4e0b\u5230\u4e0a \u5012\u7740\u6765\u7684"),d.a.createElement("li",null,"\u865a\u62dfdom\u7684\u610f\u4e49\u662f \u6211\u4eec\u628a\u5bf9dom \u7684\u64cd\u4f5c \u90fd\u4ea4\u7531\u4ed6\u6765\u5904\u7406 \u907f\u514d\u4e86\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684dom \u56de\u6d41\u548c\u91cd\u7ed8 ,\u4e5f\u5c31\u662f\u6211\u4eec\u5728\u5bf9dom \u64cd\u4f5c\u65f6\u8bfb\u5199\u5206\u79bb\u7684\u91cd\u8981\u6027 \u4ee5\u53ca\u4e00\u4e9b \u6027\u80fd\u4f18\u5316\u7684\u6ce8\u610f\u70b9"))))}));n["default"]=e=>{var n=d.a.useContext(o["context"]),t=n.demos;return d.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),d.a.createElement(r,{demos:t})}}}]);